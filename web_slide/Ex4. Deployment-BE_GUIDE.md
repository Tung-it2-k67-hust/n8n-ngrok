# DEVELOPER DECISION GUIDE: Ex4. Deployment-BE.pdf

> Generated by OpenRouter (xiaomi/mimo-v2-flash:free) on 2026-01-06 17:40:32



<!-- CHUNK 1-4 -->

# DEVELOPER DECISION GUIDE: Deploy BE to Render

## SECTION 1: CORE MENTAL MODEL

**Deployment (Triển khai)**: Quá trình đưa mã nguồn từ máy local lên máy chủ từ xa (Render) để người dùng thực tế có thể truy cập và sử dụng.

**Environment Variable (Biến môi trường)**: Cấu hình nhạy cảm (API keys, DB URI) được lưu ngoài mã nguồn, giúp bảo mật và thay đổi cấu hình mà không cần sửa code.

**Remote Repository (Kho lưu trữ từ xa)**: Github là nơi lưu trữ mã nguồn, Render sẽ kết nối và lấy code từ đây để triển khai.

**Render Web Service**: Nền tảng cung cấp máy chủ (server) chạy mã Node.js tự động, giúp bạn không cần mua/vận hành server thủ công.

## SECTION 2: DECISION TABLES

| Tình huống sử dụng | Nên dùng gì | Tại sao | Sai lầm thường gặp |
| :--- | :--- | :--- | :--- |
| **Chạy Demo/Free** | Render Free Tier ($0/month) | Chi phí thấp, dễ setup cho dự án nhỏ, học tập. | Không để ý giới hạn sleeps 15 phút, app bị tắt đột ngột. |
| **Prod Web** | Render Pro | Đảm bảo uptime 24/7, không bị sleep. | Dùng Free cho project cần chạy ổn định, liên tục. |
| **Cấu hình DB** | Environment Variables (`.env`) | **Secret Management**: Tách biệt secret ra khỏi code, dễ update mà không sửa code. | Hardcode `process.env.MONGO_URI` trực tiếp vào file code. |
| **Chạy Local** | `npm run dev` hoặc `node server.js` | Test tính năng trước khi đẩy lên Remote. | Chạy deploy luôn khi chưa test local kỹ. |
| **Cập nhật code** | Push Github -> Render Dashboard -> Deploy | Duy trì version control rõ ràng, dễ roll back. | Upload file thủ công từng cái lên server. |

## SECTION 3: ARCHITECTURE & RELATIONSHIPS

**Hệ sinh thái Triển khai:**

```text
[ Developer Local ]
       |
       | 1. Code & Test
       v
[ Local `.env` ] -----> (ĐỊNH NGHĨA CẤU HÌNH)
       |
       | 2. `git push` (Bỏ qua .env)
       v
[ GitHub Repository ] <------------------------+
       |                                      |
       | 3. Connect & Pull Source              |
       v                                      |
[ Render Dashboard ]                          |
       |                                      |
       | 4. Set Environment Variables          |
       +---------------------------------------+
       | (MONGO_URI, PORT)
       v
[ Render Web Service ] (Running Node.js)
       |
       | 5. Connect to DB
       v
[ MongoDB Atlas / Database ]
```

**Luồng Logic Triển Khai:**
1. Push code lên Github (cam kết `.env` bị ignore).
2. Render kết nối Repo.
3. Render Build: `npm install` (Cài dependencies).
4. Render Start: `node server.js` (Chạy app).
5. App đọc biến môi trường từ Render để kết nối DB.

## SECTION 4: CODE PATTERNS

### Pattern 1: Cấu hình Server Slufigon & CORS
**Khi nào dùng:** Luôn dùng khi triển khai Web Service để tránh lỗi CORS và lỗi port khi chạy trên Render.

**Tại sao đúng:** Render chạy trên Cloud, cần xử lý request từ domain khác (Frontend). `process.env.PORT` giúp Render chỉ định port tự động (Render chỉ cho phép port nhất định).

```javascript
// server.js
require('dotenv').config(); // Đọc file .env
const express = require('express');
const mongoose = require('mongoose');
const cors = require('cors');

const app = express();

// Middleware để chấp nhận request từ Frontend
app.use(cors()); 
app.use(express.json());

// Lấy PORT từ biến môi trường, mặc định là 3000 nếu k có
const PORT = process.env.PORT || 3000;

// Kết nối MongoDB bằng URI từ .env
const connectDB = async () => {
  try {
    await mongoose.connect(process.env.MONGO_URI);
    console.log('MongoDB Connected');
  } catch (err) {
    console.error(err.message);
    process.exit(1); // Thoát nếu kết nối thất bại
  }
};

connectDB();

app.get('/', (req, res) => {
  res.send('API Running');
});

// Chạy server
app.listen(PORT, () => console.log(`Server started on port ${PORT}`));
```

### Pattern 2: File .env & .gitignore
**Khi nào dùng:** Luôn dùng cho mọi project có cấu hình nhạy cảm (DB, API Keys).

**Tại sao đúng:** Bảo mật. Nếu commit `.env` lên Github, ai cũng thấy mật khẩu Database của bạn.

**File `.env`:**
```env
MONGO_URI=mongodb+srv://user:password@cluster.mongodb.net/crud_db
PORT=3000
```

**File `.gitignore`:**
```text
node_modules
.env
```

## SECTION 5: ANTI-PATTERNS & WARNINGS

**1. Hardcode Database URI**
*   **Lỗi:** `mongoose.connect('mongodb://localhost:27017/mydb')` hoặc để URI thật trong code.
*   **Nguy hiểm:** Không thể thay đổi DB khi deploy (Local DB khác Cloud DB), lộ mật khẩu nếu public code.

**2. Commit File .env**
*   **Lỗi:** `git add .env` rồi push lên Github.
*   **Nguy hiểm:** Rất nguy hiểm, credential bị lộ công khai. Cần xóa ngay và đổi mật khẩu DB nếu lỡ commit.

**3. Bỏ qua Configure Build/Start Command**
*   **Lỗi:** Để mặc định hoặc nhập sai lệnh (`node app.js` trong khi file là `server.js`).
*   **Nguy hiểm:** Render báo lỗi `Build Failed` hoặc `Application Error` do không thể khởi động app.

**4. Quên Install Dependencies Locally**
*   **Lỗi:** Code có dùng thư viện mới (vd: `cors`) nhưng không chạy `npm install` trước khi push.
*   **Nguy hiểm:** `package.json` chưa có version hoặc dependency bị thiếu, gây crash app trên Render.

## SECTION 6: MASTER CHEAT SHEET

**Checklist Triển Khai (Deploy Checklist):**

1.  **Code Local:**
    *   [ ] Cài thư viện: `npm i express mongoose cors dotenv`.
    *   [ ] Code dùng `process.env.PORT` và `process.env.MONGO_URI`.
    *   [ ] File `.gitignore` có `node_modules` và `.env`.
2.  **Github:**
    *   [ ] Đã commit và push code lên Github.
3.  **Render Dashboard:**
    *   [ ] Connect Repo.
    *   [ ] Runtime: Node.
    *   [ ] Build Command: `npm install`.
    *   [ ] Start Command: `node server.js` (hoặc `npm start`).
4.  **Environment (Quan trọng nhất):**
    *   [ ] Vào **Settings** -> **Environment Variables**.
    *   [ ] Thêm `MONGO_URI` (URI của MongoDB Cloud).
    *   [ ] Thêm `PORT` (thường Render tự nhận, nhưng thêm `3000` cho chắc).
5.  **Deploy:**
    *   [ ] Nhấn **Deploy**.
    *   [ ] Đợi logs "Build Successful".
    *   [ ] Kiểm tra URL trả về.

**Lưu ý Quan trọng:**
*   **Local:** Dùng file `.env`.
*   **Render:** Dùng Dashboard Settings (Environment Variables).
*   **Luôn** test API trên Local trước khi Deploy.